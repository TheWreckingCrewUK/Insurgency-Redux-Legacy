_list=[
		["CUP_B_M119_US", [
		["gunner", 
			["Modern_Artillery_Gunner"]
		]],20,9
	],
	
			["UK3CB_BAF_Static_L16_Deployed", [
		["gunner", 
			["Modern_Artillery_Gunner"]
		]],14,10
	],
	
		["rhsusf_m1a2sep1wd_usarmy",[ 
		["driver", 
			["Modern_USMC_VehicleCrew"]
		],
		["gunner", 
			["Modern_USMC_VehicleCrew"]
		],
		["commander", 
			["Modern_USMC_VehicleCommander"]
		]],5
	],
		["rhsusf_m1a2sep1tuskiid_usarmy",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["gunner", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["Modern_British_VehicleCommander"]
		]],5
	],
		["rhsusf_m1a2sep1d_usarmy",[ 
		["driver", 
			["Modern_USMC_VehicleCrew"]
		],
		["gunner", 
			["Modern_USMC_VehicleCrew"]
		],
		["commander", 
			["Modern_USMC_VehicleCommander"]
		]],12
	],
	
		["rhsusf_M1117_D",[ 
		["driver", 
			["Modern_British_VehicleCrew","Modern_British_VehicleCommander"]
		],["gunner", 
			["Modern_British_VehicleCrew","Modern_British_VehicleCommander"]
		]],5
	],
		["rhsusf_m113d_usarmy_MK19",[ 
		["driver", 
			["Modern_USMC_VehicleCrew","Modern_USMC_VehicleCommander"]
		]],6
	],
			["rhsusf_m113d_usarmy",[ 
		["driver", 
			["Modern_USMC_VehicleCrew","Modern_USMC_VehicleCommander"]
		]],6
	],
		
		["rhsusf_m113_usarmy_MK19",[ 
		["driver", 
			["Modern_USMC_VehicleCrew","Modern_USMC_VehicleCommander"]
		]],6
	],
			["rhsusf_m113_usarmy",[ 
		["driver", 
			["Modern_USMC_VehicleCrew","Modern_USMC_VehicleCommander"]
		]],6
	],
	
		["CUP_B_MCV80_GB_W_SLAT",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["gunner", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["Modern_British_VehicleCommander"]
		]],5
	],	
	
			["CUP_B_AAV_USMC",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["gunner", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["Modern_British_VehicleCommander"]
		]],5
	],	
			["RHS_M2A3_BUSKIII",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["gunner", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["Modern_British_VehicleCommander"]
		]],5
	],	
	
			["CUP_B_MCV80_GB_D_SLAT",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["gunner", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["Modern_British_VehicleCommander"]
		]],5
	],	
	
			["CUP_B_M1130_CV_M2_Desert_Slat",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["Modern_British_VehicleCommander","Modern_British_VehicleCrew"]
		]],5
	],	
			["CUP_B_M1130_CV_M2_Woodland_Slat",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["Modern_British_VehicleCommander","Modern_British_VehicleCrew"]
		]],5
	],	
			["CUP_B_M1126_ICV_M2_Woodland_Slat",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["2000_British_Vehicle_Commander","2000_British_Vehicle_Crew"]
		]],5
	],	
			["CUP_B_M1126_ICV_M2_Desert_Slat",[ 
		["driver", 
			["2000_British_Vehicle_Crew"]
		],
		["commander", 
			["2000_British_Vehicle_Commander","2000_British_Vehicle_Crew"]
		]],5
	],	
	
		["ukcw_fv432",[ 
		["driver", 
			["Modern_British_VehicleCrew","Modern_British_VehicleCommander"]
		]],5
	],	
	
		["rhsusf_m113d_usarmy_M240",[ 
		["driver", 
			["Modern_British_VehicleCrew","Modern_British_VehicleCommander"]
		]],5
	],
	
		["CUP_B_FV432_Bulldog_GB_W",[ 
		["driver", 
			["Modern_British_VehicleCrew","Modern_British_VehicleCommander"]
		]],6
	],
	
			["CUP_B_FV432_Bulldog_GB_D",[ 
		["driver", 
			["Modern_British_VehicleCrew","Modern_British_VehicleCommander"]
		]],6
	],
		
		["rhsusf_m113d_usarmy_medical",[ 
		["driver", 
			["Modern_British_VehicleCrew","Modern_British_VehicleCommander","Modern_USMC_VehicleCrew","Modern_USMC_VehicleCommander","Modern_USMC_Medic","Modern_British_Medic"]
		]]
	],
		
		["rhsusf_m113_usarmy_medical",[ 
		["driver", 
			["Modern_British_VehicleCrew","Modern_British_VehicleCommander","Modern_USMC_VehicleCrew","Modern_USMC_VehicleCommander","Modern_USMC_Medic","Modern_British_Medic"]
		]]
	],
	
		["CUP_B_LAV25_USMC",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["gunner", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["Modern_British_VehicleCommander"]
		]],5
	],
		
		["CUP_B_LAV25_desert_USMC",[ 
		["driver", 
			["Modern_British_VehicleCrew"]
		],
		["gunner", 
			["Modern_British_VehicleCrew"]
		],
		["commander", 
			["Modern_British_VehicleCommander"]
		]],5
	],
	
		
		["UK3CB_BAF_Wildcat_AH1_CAS_8A",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		["gunner", 
			["Modern_British_crewchief"]
		]],3
	],
	
		
		["UK3CB_BAF_Wildcat_AH1_CAS_8B",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		["gunner", 
			["Modern_British_crewchief"]
		]],3
	],
	
		["ukcw_Gazelle", [
		["driver", 
			["Modern_British_HeliPilot","2000_British_HeliPilot_Desert"]
		],
		["turret", 
			["Modern_British_crewchief"]
		]],3
	],
	
		["CUP_B_UH1Y_Gunship_Dynamic_USMC",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		[[2], 
			["Modern_British_crewchief"]
		]],3
	],	
	
		["UK3CB_BAF_Wildcat_AH1_HEL_8A",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		["gunner", 
			["Modern_British_crewchief"]
		]],3
	],
	

		["RHS_AH64D",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		["Turret", 
			["Modern_British_crewchief"]
		]],7
	],

		["RHS_AH1Z",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		["Turret", 
			["Modern_British_crewchief"]
		]],7
	],
		["CUP_O_UH1H_TKA",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		[[2], 
			["Modern_British_crewchief"]
		]],3
	],	
		["rhsgref_cdf_b_Mi24D_Early",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		[[0], 
			["Modern_British_crewchief"]
		]],3
	],	
		["rhsgref_cdf_Mi24D_Early",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		[[0], 
			["Modern_British_crewchief"]
		]],3
	],	


		["CUP_B_CH47F_GB",[ 
		["driver", 
			["Modern_British_HeliPilot","Modern_USMC_HeliPilot","2000_British_HeliPilot_Desert"]
		],
		[[3], 
			["Modern_British_crewchief","Modern_USMC_crewchief","Modern_British_HeliPilot"]
		]],3
	],
	
		["CUP_B_MV22_USMC_RAMPGUN",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		["gunner", 
			["Modern_British_crewchief"]
		]],3
	],	
		["CUP_O_Mi8_CHDKZ",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		[[2], 
			["Modern_British_crewchief"]
		]],3
	],	
		["RHS_UH1Y_d",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		[[0], 
			["Modern_British_crewchief"]
		]],3
	],	
		["UK3CB_BAF_Merlin_HC3_18_GPMG",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		["gunner", 
			["Modern_British_crewchief"]
		]],3
	],	
	
		["RHS_UH60M",[ 
		["driver", 
			["Modern_British_HeliPilot"]
		],
		[[0], 
			["Modern_British_crewchief"]
		]],3
	],
	
				["CUP_B_A10_DYN_USA", [
		["driver", 
			["Modern_British_JetPilot"]
		]],10
	],
		
					["CUP_B_GR9_DYN_GB", [
		["driver", 
			["Modern_British_JetPilot"]
		]],8
	],
	
		["TWC_Vehicle_Generic_Hercules_RAF", [
		["driver", 
			["Modern_British_JetPilot"]
		],
		["turret", 
			["Modern_British_JetPilot"]
		]],6
	],
	
		["CUP_B_C130J_Cargo_GB",[
		["driver",
			["Modern_British_JetPilot"]
		],
		["turret", 
			["Modern_British_JetPilot"]
		]],6
	],
	
		["ukcw_cvrt_Scim_d",[
		["driver",
			["Modern_British_VehicleCrew"]
		],
		["gunner", 
			["Modern_British_VehicleCrew"]
		],
		["Commander", 
			["Modern_British_VehicleCommander"]
		]],0
	],
	
		["ukcw_cvrt_Scim_w",[
		["driver",
			["Modern_British_VehicleCrew"]
		],
		["gunner", 
			["Modern_British_VehicleCrew"]
		],
		["Commander", 
			["Modern_British_VehicleCommander"]
		]],0
	]
	]
;
{twc_restrictedVehicleSlots pushback _x} foreach _list;

twc_fullvehicles = ["ukcw_cvrt_Scim_w", "ukcw_cvrt_Scim_d", "CUP_B_MCV80_GB_D_SLAT", "RHS_AH64D", "RHS_AH1Z", "CUP_B_LAV25_desert_USMC", "CUP_B_LAV25_USMC", "CUP_B_M1130_CV_M2_Woodland_Slat", "CUP_B_M1130_CV_M2_Desert_Slat", "CUP_B_AAV_USMC", "RHS_M2A3_BUSKIII", "rhsusf_m1a2sep1tuskiid_usarmy", "rhsusf_M1117_D"];


TWC_fnc_notAllowedInSeat = {
	params ["_playerUnit"];
	[_playerUnit] spawn {
	params ["_playerUnit"];
	sleep 1;
	_freePassengerSpace = (vehicle _playerUnit) emptyPositions "cargo";
	_title  = "<t color='#ff0000' size='1.2' shadow='1' shadowColor='#000000' align='center'>RESTRICTED</t>";

	// move them to the passenger seats first, prevents annoyance/unnecessary death in the air
	if (_freePassengerSpace > 0) exitWith {
		_veh = vehicle _playerUnit;
		moveOut _playerUnit;
		_playerUnit moveInCargo _veh;
		_text = "<br />You are not qualified for that slot. Take a seat in back.";
		hint parseText (_title + _text);
	};
	
	moveOut _playerUnit;
	_text = "<br />You are not qualified for that slot.";
	hint parseText (_title + _text);
};
};
TWC_fnc_notenoughplayers = {
	params ["_playerUnit","_count","_currentcount","_problem"];
	[_playerUnit,_count,_currentcount,_problem] spawn {
	params ["_playerUnit","_count","_currentcount","_problem"];
	sleep 1;
	if (_problem == "low") then {
	_title  = "<t color='#ff0000' size='1.2' shadow='1' shadowColor='#000000' align='center'>Not Enough Players</t>";

	moveOut _playerUnit;
	if (_Currentcount > 1) then {
	_text1 = "<br />There are ";
	_text2 = " players in the server.";
	_text3 = "<br />You need ";
	_text4 = " to be able to use this vehicle";
	hint parseText (_title + _text1 + str _currentcount + _text2 + _text3 + str _count + _text4);
	} else
	{
	_text1 = "<br />You're the only player on the server.";
	_text3 = "<br />You need more than ";
	_text4 = " to be able to use this vehicle";
	
	
	hint parseText (_title + _text1 + _text3 + str _count + _text4);
	};}
	
	else
	{
	
	_title  = "<t color='#ff0000' size='1.2' shadow='1' shadowColor='#000000' align='center'>Too Many Players</t>";

	moveOut _playerUnit;
	_text1 = "<br />There are ";
	_text2 = " players in the server.";
	_text3 = "<br />You need less than ";
	_text4 = " to be able to use this vehicle";
	hint parseText (_title + _text1 + str _currentcount + _text2 + _text3 + str _count + _text4);
	};
	
	};
};



TWC_fnc_checkVehicleSlot = {
	params ["_playerUnit"];
	if (vehicle _playerUnit == _playerUnit) exitWith { false; }; // double check
	
	_slotFull = fullCrew vehicle _playerUnit select {(_x select 0) isEqualTo _playerUnit};
	_slotFullData = _slotFull select 0;
	_currentSeat = _slotFullData select 1;
	_currentSeatTurretPath = _slotFullData select 3;
	
	{
		_vehicle = (_x select 0);
		_slotsAndRoles = (_x select 1);
		_count = (_x select (count (_x)-1));
		_maxcount = (_x select (count (_x)-2));
		_currentcount = (count(allPlayers - entities "HeadlessClient_F"));
		_snipercount = 0;
		
		if ((typeOf player) in ["Modern_British_Sniper_coin", "Modern_British_Spotter_coin","Modern_Artillery_Commander","Modern_Artillery_Gunner"]) then {
			if (_snipercount > _currentcount) then {
				[_playerUnit, _snipercount, _currentcount, "low"] call TWC_fnc_notenoughplayers;
			};
		};
		
		if (typeof (vehicle _playerUnit) == _vehicle) then {
			{
				_slot = (_x select 0);
				_roles = (_x select 1);

				_checkWith = _currentSeat;
				if (typeName _slot == "ARRAY") then { _checkWith = _currentSeatTurretPath select 0; _slot= _slot select 0;};
			
				if (_checkWith == _slot) then {
					if (!(typeOf _playerUnit in _roles)) then {
						[_playerUnit] call TWC_fnc_notAllowedInSeat;
				

					} else {
								if (((typeof vehicle _playerUnit)) in twc_fullvehicles) then {
								[_currentSeat, _slotsAndRoles] execvm "Insurgency_Core\client\sys_restrict\fullvehicle.sqf"; };
						if (typename _count == "SCALAR") then {
							if (_count > _currentcount) then {
								[_playerUnit, _count, _currentcount, "low"] call TWC_fnc_notenoughplayers;
							} else {
								if (typename _maxcount == "SCALAR") then {
									if (_maxcount < _currentcount) then {
										[_playerUnit, _count, _currentcount, "high"] call TWC_fnc_notenoughplayers;
									};
								};
							};
						};
					};
				};
			} forEach _slotsAndRoles;
		};
	} forEach twc_restrictedVehicleSlots;
};

[player, "GetInMan", {
	params ["_playerUnit"];
	
	if (isPlayer _playerUnit) then {
	if ((str (typeof vehicle _playerUnit)) in twc_fullvehicles) then {
execvm "Insurgency_Core\client\sys_restrict\fullvehicle.sqf"; };
		[_playerUnit] call TWC_fnc_checkVehicleSlot;
	};
}, player] call CBA_fnc_addBISEventHandler;

[player, "SeatSwitchedMan", {
	params ["_playerUnit"];
	
	if (isPlayer _playerUnit) then {
		[_playerUnit] call TWC_fnc_checkVehicleSlot;
	};
}, player] call CBA_fnc_addBISEventHandler;
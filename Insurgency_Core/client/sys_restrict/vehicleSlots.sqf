_pilots = ["Modern_British_HeliPilot","Modern_British_MERT_HeliPilot","2000_British_HeliPilot_Desert","2000_British_HeliPilot","1990_British_HeliPilot","1990_British_HeliPilot_Desert","Modern_British_MERT_HeliPilot","1970_British_HeliPilot","CUP_O_RU_Pilot_VDV_EMR"];

_crewchiefs = ["Modern_British_crewchief","2000_British_CrewChief","2000_British_CrewChief_Desert","1990_British_Crewchief","1970_British_Crewchief","CUP_O_RU_Pilot_VDV"];

_armourcrew = ["Modern_British_VehicleCrew","Modern_USMC_VehicleCrew","1990_British_Tank_Crew_Desert","2000_British_Vehicle_Crew","1970_British_Vehicle_Crew", "CUP_O_RU_Crew_VDV_EMR"];

_armourcommanders = ["Modern_British_VehicleCommander","Modern_USMC_VehicleCommander","1990_British_Tank_Commander_Desert","2000_British_Vehicle_Commander","1970_British_Vehicle_Commander","CUP_O_RU_Crew_VDV_EMR"];

_sf = ["Modern_UKSF_Base","Modern_UKSF_Pointman","Modern_UKSF_2IC","Modern_UKSF_Squadleader","Modern_UKSF_Grenadier","Modern_UKSF_Marksman","Modern_UKSF_Medic","Modern_British_Sniper_coin","Modern_British_Spotter_coin"];

_list=[
		["CUP_B_M119_US", [
		["gunner", 
			["Modern_Artillery_Gunner"]
		]],20,9
	],
	
			["UK3CB_BAF_Static_L16_Deployed", [
		["gunner", 
			["Modern_Artillery_Gunner"]
		]],14,10
	],
		["B_APC_Wheeled_01_cannon_F",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],5
	],
		["CUP_O_BTR60_Green_RU",[ 
		["gunner", 
			_armourcrew + _armourcommanders
		]],5
	],
		["CUP_O_MTLB_pk_WDL_RU",[ 
		["gunner", 
			_armourcrew + _armourcommanders
		]],5
	],
		["CUP_I_BMP1_TK_GUE",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew + _armourcommanders
		]],5
	],
	
		["UK3CB_BAF_LandRover_Hard_FFR_Green_A_TWCBaseRadio",[
		["driver",
			["literally noone"]
		]],6
	],
		["CUP_B_M1A2_TUSK_MG_US_Army",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],
	
		["CUP_B_MCV80_GB_W_SLAT",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],	
	
			["CUP_B_AAV_USMC",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],	
			["CUP_B_M2Bradley_USA_W",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],	
			["CUP_B_M2A3Bradley_USA_W",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],	
	
			["CUP_B_MCV80_GB_D_SLAT",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],	
	
			["CUP_B_M1130_CV_M2_Desert_Slat",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["commander", 
			_armourcrew + _armourcommanders
		]],0
	],	
			["CUP_B_M1130_CV_M2_Woodland_Slat",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["commander", 
			_armourcrew + _armourcommanders
		]],0
	],	
			["CUP_B_M1126_ICV_M2_Woodland_Slat",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["commander", 
			_armourcrew + _armourcommanders
		]],0
	],	
			["CUP_B_M1126_ICV_M2_Desert_Slat",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["commander", 
			_armourcrew + _armourcommanders
		]],0
	],	
	
		["ukcw_fv432_gpmg",[ 
		["driver", 
			_armourcrew + _armourcommanders
		]],0
	],	
	
		["CUP_B_M113_desert_USA",[ 
		["driver", 
			_armourcrew + _armourcommanders
		]],0
	],
	
		["CUP_B_M113_USA",[ 
		["driver", 
			_armourcrew + _armourcommanders
		]],0
	],
	
		["CUP_B_FV432_Bulldog_GB_W",[ 
		["driver", 
			_armourcrew + _armourcommanders
		]],0
	],
	
			["CUP_B_FV432_Bulldog_GB_D",[ 
		["driver", 
			_armourcrew + _armourcommanders
		]],0
	],
		["CUP_B_LAV25_USMC",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],
		
		["CUP_B_LAV25_desert_USMC",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],
	
		
		["ukcw_lynx_2gpmg",[ 
		["driver", 
			_pilots
		],
		["gunner", 
			_crewchiefs
		]],3
	],
		
		["UK3CB_BAF_Wildcat_AH1_HEL_6A",[ 
		["driver", 
			_pilots
		],
		["gunner", 
			_crewchiefs
		]],3
	],
		
		["UK3CB_BAF_Wildcat_AH1_CAS_8A",[ 
		["driver", 
			_pilots
		],
		["gunner", 
			_crewchiefs
		]],3
	],
	
		
		["UK3CB_BAF_Wildcat_AH1_CAS_8B",[ 
		["driver", 
			_pilots
		],
		["gunner", 
			_crewchiefs
		]],3
	],
	
		["ukcw_Gazelle", [
		["driver", 
			_pilots
		],
		["turret", 
			_crewchiefs
		]],3
	],
	
		["CUP_B_SA330_Puma_HC2_BAF", [
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		]],3
	],
	
		["ukcw_Gazelle_dyn", [
		["driver", 
			_pilots
		],
		["turret", 
			_crewchiefs
		]],3
	],
	
		["CUP_B_UH1Y_Gunship_Dynamic_USMC",[ 
		["driver", 
			_pilots
		],
		[[2], 
			_crewchiefs
		]],3
	],	
	
		["UK3CB_BAF_Wildcat_AH1_HEL_8A",[ 
		["driver", 
			_pilots
		],
		["gunner", 
			_crewchiefs
		]],3
	],
	

		["UK3CB_BAF_Apache_AH1_DynamicLoadout",[ 
		["driver", 
			_pilots
		],
		["gunner", 
			_crewchiefs
		]],7
	],

		["CUP_B_AH1Z_Dynamic_USMC",[ 
		["driver", 
			_pilots
		],
		["Turret", 
			_crewchiefs
		]],7
	],
		["CUP_O_UH1H_TKA",[ 
		["driver", 
			_pilots
		],
		[[2], 
			_crewchiefs
		]],3
	],	
		["CUP_O_Mi8_RU",[ 
		["driver", 
			_pilots + _crewchiefs
		],
		[[0], 
			_crewchiefs + _pilots
		]],3
	],	
		["CUP_B_Mi24_D_Dynamic_CDF",[ 
		["driver", 
			_pilots
		],
		["gunner", 
			_crewchiefs
		]],3
	],	
	


		["CUP_B_CH47F_GB",[
		["driver", 
			_pilots + _crewchiefs
		],
		[[3], 
			_crewchiefs
		]],3
	],
		["CUP_B_MH47E_GB",[
		["driver", 
			_pilots
		],
		[[2], 
			_crewchiefs
		]],3
	],
		["ukcw_chinook_hc1",[
		["driver", 
			_pilots
		],
		[[3], 
			_crewchiefs
		]],3
	],
		["CUP_B_SA330_Puma_HC1_BAF",[
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		]],3
	],

		["twc_mert_ch47",[ 
		["driver", 
			["Modern_British_MERT_HeliPilot"]
		],
		[[3], 
			["Modern_British_MERT_HeliPilot"]
		]],3
	],
		["CUP_B_UH60M_US_ESSS_d",[ 
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		]],0
	],
	
		["CUP_B_MV22_USMC_RAMPGUN",[ 
		["driver", 
			_pilots
		],
		[[1], 
			_crewchiefs
		]],3
	],	
		["CUP_O_Mi8_CHDKZ",[ 
		["driver", 
			_pilots
		],
		[[2], 
			_crewchiefs
		]],3
	],	
		["CUP_B_UH1Y_UNA_USMC",[ 
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		]],3
	],	
		["UK3CB_BAF_Merlin_HC3_18_GPMG",[ 
		["driver", 
			_pilots
		],
		["gunner", 
			_crewchiefs
		]],3
	],	
	
		["CUP_B_UH60M_US",[ 
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		]],3
	],
		["CUP_B_UH60M_US_d",[ 
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		]],3
	],
		["B_Heli_Transport_01_F",[ 
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		],
		[[1], 
			_sf + _pilots + _crewchiefs
		],
		[[2], 
			_sf + _pilots + _crewchiefs
		],
		[[3], 
			_sf + _pilots + _crewchiefs
		],
		["cargo", 
			_sf + _pilots + _crewchiefs
		]],3
	],
	
		["CUP_B_UH60M_US_ESSS",[ 
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		]],3
	],
	
		["CUP_B_UH60M_FFV_US",[ 
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		]],3
	],
		["CUP_B_MH47E_USA",[ 
		["driver", 
			_pilots
		],
		[[2], 
			_crewchiefs
		]],3
	],
	
		["CUP_B_CH47F_USA",[ 
		["driver", 
			_pilots
		],
		[[0], 
			_crewchiefs
		]],3
	],
		["CUP_B_MH6M_USA",[ 
		["driver", 
			_pilots
		],
		["gunner", 
			_crewchiefs
		],
		[[1], 
			_sf + _pilots + _crewchiefs
		],
		[[2], 
			_sf + _pilots + _crewchiefs
		],
		[[3], 
			_sf + _pilots + _crewchiefs
		],
		[[4], 
			_sf + _pilots + _crewchiefs
		],
		[[5], 
			_sf + _pilots + _crewchiefs
		],
		[[6], 
			_sf + _pilots + _crewchiefs
		],
		["cargo", 
			_sf + _pilots + _crewchiefs
		]],3
	],
		["CUP_B_AH6M_USA",[ 
		["driver", 
			_pilots + _crewchiefs
		],
		["gunner", 
			_pilots + _crewchiefs
		]],3
	],
	
				["USAF_AC130U", [
		["driver", 
			["Modern_British_JetPilot"]
		], [[0], 
			["Modern_British_JetPilot"]
		], ["gunner", 
			["Modern_British_FAC", "Modern_British_JetPilot"]
		]],10
	],
				["CUP_B_A10_DYN_USA", [
		["driver", 
			["Modern_British_JetPilot"]
		]],10
	],
	
				["CUP_B_C130J_GB", [
		["driver", 
			["Modern_British_JetPilot"]
		]],5
	],
		
					["CUP_B_GR9_DYN_GB", [
		["driver", 
			["Modern_British_JetPilot"]
		]],8
	],
	
		["TWC_Vehicle_Generic_Hercules_RAF", [
		["driver", 
			["Modern_British_JetPilot"]
		],
		["turret", 
			["Modern_British_JetPilot"]
		]],6
	],
	
		["CUP_B_C130J_Cargo_GB",[
		["driver",
			["Modern_British_JetPilot"]
		],
		["turret", 
			["Modern_British_JetPilot"]
		]],6
	],
		["CUP_B_M1A1_Woodland_US_Army",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],
	
		["UK3CB_BAF_FV432_Mk3_GPMG_Green",[
		["driver",
			_armourcrew + _armourcommanders
		]],0
	],
	
		["UK3CB_BAF_FV432_Mk3_GPMG_Sand",[
		["driver",
			_armourcrew + _armourcommanders
		]],0
	],
	
		["UK3CB_BAF_FV432_Mk3_RWS_Sand",[
		["driver",
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew + _armourcommanders
		]],0
	],
	
		["UK3CB_BAF_FV432_Mk3_RWS_Green",[
		["driver",
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew + _armourcommanders
		]],0
	],
			["CUP_B_M6LineBacker_USA_W_wd",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],
			["CUP_B_M6LineBacker_USA_W",[ 
		["driver", 
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],
	
		["ukcw_cvrt_Scim_d",[
		["driver",
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],
	
		["ukcw_cvrt_Scim_d_L1",[
		["driver",
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],
	
		["ukcw_cvrt_Scim_w_L1",[
		["driver",
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	],
	
	
		["ukcw_cvrt_Scim_w",[
		["driver",
			_armourcrew + _armourcommanders
		],
		["gunner", 
			_armourcrew
		],
		["commander", 
			_armourcommanders
		]],0
	]
	]
;
{twc_restrictedVehicleSlots pushback _x} foreach _list;

twc_fullvehicles = [
"ukcw_cvrt_Scim_w",
 "ukcw_cvrt_Scim_d",
 "ukcw_cvrt_Scim_w_L1",
 "ukcw_cvrt_Scim_d_L1",
 "CUP_B_MCV80_GB_D_SLAT",
 "CUP_B_MCV80_GB_W_SLAT",
 "UK3CB_BAF_Apache_AH1_DynamicLoadout",
 "CUP_B_AH1Z_Dynamic_USMC",
 "CUP_B_LAV25_desert_USMC",
 "CUP_B_LAV25_USMC",
 "CUP_B_M1130_CV_M2_Woodland_Slat",
 "CUP_B_M1130_CV_M2_Desert_Slat",
 "CUP_B_M1126_ICV_M2_Desert_Slat",
 "CUP_B_M1126_ICV_M2_Woodland_Slat",
 "CUP_B_AAV_USMC",
 "CUP_B_M2A3Bradley_USA_W",
 "CUP_B_M2A3Bradley_USA_W_wd",
 "CUP_B_Mi24_D_Dynamic_CDF",
 "CUP_B_M1A2_TUSK_MG_US_Army",
 "CUP_B_M1A2_TUSK_MG_US_Army",
 "UK3CB_BAF_FV432_Mk3_RWS_Sand",
 "UK3CB_BAF_FV432_Mk3_RWS_Green",
 "CUP_B_M6LineBacker_USA_W",
 "CUP_B_M6LineBacker_USA_W_wd"];


TWC_fnc_notAllowedInSeat = {
	params ["_playerUnit", ["_nightonly", false]];
	[_playerUnit, _nightonly] spawn {
	params ["_playerUnit", "_nightonly"];
	sleep 1;
	//if (isserver) exitwith {hint "Seat restrict triggered, but not enforcing on singleplayer"};
	_freePassengerSpace = (vehicle _playerUnit) emptyPositions "cargo";
	_title  = "<t color='#ff0000' size='1.2' shadow='1' shadowColor='#000000' align='center'>RESTRICTED</t>";

	// move them to the passenger seats first, prevents annoyance/unnecessary death in the air
	if (_freePassengerSpace > 0) exitWith {
		_veh = vehicle _playerUnit;
		moveOut _playerUnit;
		_text = "<br />You are not qualified for that slot.";
		if (_nightonly) then {
			_text = "<br />This aircraft is only permitted to fly at night.";
		};
		if ((player getvariable ["twc_lastkickedfromveh", -999]) < (time -5)) then {
			_playerUnit moveInCargo _veh;
			_text = "<br />You are not qualified for that slot. Take a seat in back.";
			if (_nightonly) then {
				_text = "<br />This aircraft is only permitted to fly at night. Take a seat in back.";
			};
		};
		player setvariable ["twc_lastkickedfromveh", time];
		hint parseText (_title + _text);
	};
	
	moveOut _playerUnit;
	_text = "<br />You are not qualified for that slot.";
	if (_nightonly) then {
		_text = "<br />This aircraft is only permitted to fly at night.";
	};
	hint parseText (_title + _text);
};
};
TWC_fnc_notenoughplayers = {
	/*params ["_playerUnit","_count","_currentcount","_problem"];
	[_playerUnit,_count,_currentcount,_problem] spawn {
	params ["_playerUnit","_count","_currentcount","_problem"];
	sleep 1;
	if (_problem == "low") then {
	_title  = "<t color='#ff0000' size='1.2' shadow='1' shadowColor='#000000' align='center'>Not Enough Players</t>";

	moveOut _playerUnit;
	if (_Currentcount > 1) then {
	_text1 = "<br />There are ";
	_text2 = " players in the server.";
	_text3 = "<br />You need ";
	_text4 = " to be able to use this vehicle";
	hint parseText (_title + _text1 + str _currentcount + _text2 + _text3 + str _count + _text4);
	} else
	{
	_text1 = "<br />You're the only player on the server.";
	_text3 = "<br />You need more than ";
	_text4 = " to be able to use this vehicle";
	
	
	hint parseText (_title + _text1 + _text3 + str _count + _text4);
	};}
	
	else
	{
	
	_title  = "<t color='#ff0000' size='1.2' shadow='1' shadowColor='#000000' align='center'>Too Many Players</t>";

	moveOut _playerUnit;
	_text1 = "<br />There are ";
	_text2 = " players in the server.";
	_text3 = "<br />You need less than ";
	_text4 = " to be able to use this vehicle";
	hint parseText (_title + _text1 + str _currentcount + _text2 + _text3 + str _count + _text4);
	};
	
	};*/
};



TWC_fnc_checkVehicleSlot = {
	params ["_playerUnit"];
	if (vehicle _playerUnit == _playerUnit) exitWith { false; }; // double check
	
	_slotFull = fullCrew vehicle _playerUnit select {(_x select 0) isEqualTo _playerUnit};
	_slotFullData = _slotFull select 0;
	_currentSeat = _slotFullData select 1;
	_currentSeatTurretPath = _slotFullData select 3;
	
	{
		_vehicle = (_x select 0);
		_slotsAndRoles = (_x select 1);
		_count = (_x select (count (_x)-1));
		_maxcount = (_x select (count (_x)-2));
		_currentcount = (count(allPlayers - entities "HeadlessClient_F"));
		_snipercount = 0;
		
		if ((typeOf player) in ["Modern_British_Sniper_coin", "Modern_British_Spotter_coin","Modern_Artillery_Commander","Modern_Artillery_Gunner"]) then {
			if (_snipercount > _currentcount) then {
				[_playerUnit, _snipercount, _currentcount, "low"] call TWC_fnc_notenoughplayers;
			};
		};
		
		if (typeof (vehicle _playerUnit) == _vehicle) then {
			{
				_slot = (_x select 0);
				_roles = (_x select 1);
				
				
				
				_checkWith = _currentSeat;
				if (typeName _slot == "ARRAY") then { _checkWith = _currentSeatTurretPath select 0; _slot= _slot select 0;};
			
				if (_checkWith == _slot) then {
				
					_nightonly = ["USAF_AC130U"];
					if ((_vehicle in _nightonly) && (!((daytime < (((date call BIS_fnc_sunriseSunsetTime) select 0) - 0.8)) || (daytime > (((date call BIS_fnc_sunriseSunsetTime) select 1) - 1))))) then {
						[_playerUnit, true] call TWC_fnc_notAllowedInSeat;
					};
				
					if (!(typeOf _playerUnit in _roles)) then {
					
								
						[_playerUnit] call TWC_fnc_notAllowedInSeat;
				

					} else {
								if (((typeof vehicle _playerUnit)) in twc_fullvehicles) then {
								[_currentSeat, _slotsAndRoles] execvm "Insurgency_Core\client\sys_restrict\fullvehicle.sqf"; };
						if (typename _count == "SCALAR") then {
							if (_count > _currentcount) then {
								[_playerUnit, _count, _currentcount, "low"] call TWC_fnc_notenoughplayers;
							} else {
								if (typename _maxcount == "SCALAR") then {
									if (_maxcount < _currentcount) then {
										[_playerUnit, _count, _currentcount, "high"] call TWC_fnc_notenoughplayers;
									};
								};
							};
						};
					};
				};
			} forEach _slotsAndRoles;
		};
	} forEach twc_restrictedVehicleSlots;
};

[player, "GetInMan", {
	params ["_playerUnit"];
	
	if (isPlayer _playerUnit) then {
	if ((str (typeof vehicle _playerUnit)) in twc_fullvehicles) then {
execvm "Insurgency_Core\client\sys_restrict\fullvehicle.sqf"; };
		[_playerUnit] call TWC_fnc_checkVehicleSlot;
	};
}, player] call CBA_fnc_addBISEventHandler;

[player, "SeatSwitchedMan", {
	params ["_playerUnit"];
	
	if (isPlayer _playerUnit) then {
		[_playerUnit] call TWC_fnc_checkVehicleSlot;
	};
}, player] call CBA_fnc_addBISEventHandler;